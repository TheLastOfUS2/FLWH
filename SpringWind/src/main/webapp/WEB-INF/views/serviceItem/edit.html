<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSPINIA | Basic Form</title>
    <link href="#springUrl('/static/css/bootstrap.min.css')" rel="stylesheet">
    <link href="#springUrl('/static/css/style.css')" rel="stylesheet">
    <link href="#springUrl('/static/css/fileinput.min.css')" rel="stylesheet">
    <script src="#springUrl('/static/js/jquery-2.1.1.js')"></script>
    <script src="#springUrl('/static/js/fileinput.min.js')"></script>
    <script src="#springUrl('/static/js/locales/zh.js')"></script>
    <script src="#springUrl('/static/plugins/nice-validator-0.8.1/jquery.validator.js?local=zh-CN')"></script>
    <style type="text/css">
        .clear {
            clear: both;
        }
    </style>
    <script type="text/javascript">

    </script>
</head>
<body class="white-bg">
<div class="ibox-content" style="width: 95%;">
   <form id="myForm" class="form-horizontal" autocomplete="off" data-validator-option="{theme:'default'}">
       <input type="hidden" name="serviceItemId" value="$!{serviceItem.serviceItemId}">
       <div class="form-group">
           <label class="col-md-3 control-label">业务标题</label>
           <div class="col-md-9">
               <input id="titleText" type="text" class="form-control"  name="titleText"  value="$!{serviceItem.titleText}">
           </div>
       </div>
       <div class="form-group">
           <label class="col-md-3 control-label">业务描述</label>
           <div class="col-md-9">
               <textarea id="describeText" rows="3" class="form-control"  name="describeText">$!{serviceItem.describeText}</textarea>
           </div>
       </div>
       <!--业务类型-->
       <div class="form-group">
           <label class="col-md-3 control-label">业务类型</label>
           <div class="col-md-9">
               <select class="form-control m-b selector" name="serviceType" id="serviceType">
                   <option value="1" text="1">活动策划执行</option>
                   <option value="2" text="2">会议承办</option>
                   <option value="3" text="3">影视拍摄</option>
                   <option value="4" text="4">视觉传达</option>
                   <option value="5" text="5">新媒体互动营销</option>
               </select>
           </div>
       </div>
       <div class="form-group">
           <label  class="col-md-3 control-label">首图</label>
           <div class="col-md-9">
               <input id="myFile" type="file" name="myFile" class="fileloading">
           </div>
           <input type="hidden" name="titleImage" id="titleImage"  value="$!{serviceItem.titleImage}">
       </div>
       <div class="form-group">
           <label  class="col-md-3 control-label">商标图</label>
           <div class="col-md-9">
               <input id="myFiles" type="file" name="myFile" class="fileloading">
           </div>
           <input type="hidden" name="describeImage" id="describeImage"  value="$!{serviceItem.describeImage}">
       </div>
       <div class="form-group">
           <label  class="col-md-3 control-label">内容</label>
           <div class="col-md-9">
               <script id="content" type="text/plain"></script>
           </div>
           <input name="editText" type="hidden" id="editText">
       </div>
       <div class="hr-line-dashed"></div>
       <div class="form-group">
           <div class="text-center">
               <button class="btn btn-primary" type="submit">#if($!{serviceItem})修 改#else提 交#end</button>
           </div>
       </div>
    </form>
</div>
<!--<script type="text/javascript" charset="utf-8" src="../assets/plugins/ueditor/ueditor.config.js"></script>-->
<!--<script type="text/javascript" charset="utf-8" src="../assets/plugins/ueditor/ueditor.all.js"> </script>-->
<!--<script type="text/javascript" charset="utf-8" src="../assets/plugins/ueditor/lang/zh-cn/zh-cn.js"></script>-->
<script type="text/javascript" charset="utf-8" src="../../ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../ueditor/ueditor.all.js"></script>
<script type="text/javascript">
    $(function () {
        var ue = UE.getEditor('content',{
            toolbars: [[//工具条
                'anchor', //锚点
                'undo', //撤销
                'redo', //重做
                'bold', //加粗
                'indent', //首行缩进
                'italic', //斜体
                'underline', //下划线
                'strikethrough', //删除线
                'subscript', //下标
                'fontborder', //字符边框
                'superscript', //上标
                'formatmatch', //格式刷
                'pasteplain', //纯文本粘贴模式
                'selectall', //全选
                'preview', //预览
                'horizontal', //分隔线
                'removeformat', //清除格式
                'time', //时间
                'date', //日期
                'unlink', //取消链接
                'insertrow', //前插入行
                'insertcol', //前插入列
                'mergeright', //右合并单元格
                'mergedown', //下合并单元格
                'deleterow', //删除行
                'deletecol', //删除列
                'splittorows', //拆分成行
                'splittocols', //拆分成列
                'splittocells', //完全拆分单元格
                'deletecaption', //删除表格标题
                'inserttitle', //插入标题
                'mergecells', //合并多个单元格
                'deletetable', //删除表格
                'cleardoc', //清空文档
                'insertparagraphbeforetable', //"表格前插入行"
                'insertcode', //代码语言
                'fontfamily', //字体
                'fontsize', //字号
                'paragraph', //段落格式
                'simpleupload', //单图上传
                'insertimage', //多图上传
                'edittable', //表格属性
                'edittd', //单元格属性
                'link', //超链接
                'emotion', //表情
                'spechars', //特殊字符
                'searchreplace', //查询替换
                'map', //Baidu地图
                'justifyleft', //居左对齐
                'justifyright', //居右对齐
                'justifycenter', //居中对齐
                'justifyjustify', //两端对齐
                'forecolor', //字体颜色
                'backcolor', //背景色
                'insertorderedlist', //有序列表
                'insertunorderedlist', //无序列表
                'fullscreen', //全屏
                'directionalityltr', //从左向右输入
                'directionalityrtl', //从右向左输入
                'rowspacingtop', //段前距
                'rowspacingbottom', //段后距
                'imageleft', //左浮动
                'imageright', //右浮动
                'attachment', //附件
                'imagecenter', //居中
                'wordimage', //图片转存
                'lineheight', //行间距
                'edittip ', //编辑提示
                'customstyle', //自定义标题
                'autotypeset', //自动排版
                'touppercase', //字母大写
                'tolowercase', //字母小写
                'background', //背景
                'template', //模板
                'scrawl', //涂鸦
                'inserttable', //插入表格
                'drafts', // 从草稿箱加载
                'charts', // 图表
            ]]
        });
        //异步回调
        ue.ready(function() {
            ue.setContent("");
            var editTextOld = '${serviceItem.editText}';
            console.log(editTextOld);
            if (editTextOld!=="\${serviceItem.editText}".toString()){
                ue.execCommand('inserthtml',editTextOld);
            }
        });

        $(".selector").find("option[text='$!{serviceItem.serviceType}']").attr("selected", true);


    });

    var path = [];
    path.push($("#titleImage").val());

    var paths = [];
    paths.push($("#describeImage").val());

    $("#myFile").fileinput({
        language : 'zh',
        uploadUrl : "/SpringWind/sys/common/upload",
        autoReplace : true,
        maxFileCount : 1,
        allowedFileExtensions : [ "jpg", "png", "gif" ],
        browseClass : "btn btn-primary", //按钮样式
        previewFileIcon : "<i class='glyphicon glyphicon-king'></i>",
        initialPreviewAsData: true, // 特别重要
        initialPreviewFileType: 'image',
        initialPreview:path, //要显示的图片的路径
        initialPreviewConfig: [
            {key:1,showDelete: false}
        ]
    }).on("fileuploaded", function(e, data) {
        var res = data.response;
        $("#titleImage").attr("value", res.success);
        console.log("1111");
    });

    $("#myFiles").fileinput({
        language : 'zh',
        uploadUrl : "/SpringWind/sys/common/upload",
        autoReplace : true,
        maxFileCount : 1,
        allowedFileExtensions : [ "jpg", "png", "gif" ],
        browseClass : "btn btn-primary", //按钮样式
        previewFileIcon : "<i class='glyphicon glyphicon-king'></i>",
        initialPreviewAsData: true, // 特别重要
        initialPreviewFileType: 'image',
        initialPreview:paths, //要显示的图片的路径
        initialPreviewConfig: [
            {key:1,showDelete: false}
        ]
    }).on("fileuploaded", function(e, data) {
        var res = data.response;
        $("#describeImage").attr("value", res.success);
        console.log("2222");
    });

    $("#myForm").validator({
    valid: function(form){
        var me = this;
        me.holdSubmit();
        // 提交表单之前，hold住表单，防止重复提交
        if (!UE.getEditor('content').hasContents()){
            alert('请先填写内容!');
        }else{
            var editText=UE.getEditor('content').getContent();
            $("#editText").attr("value", editText);
            $("#myForm").validator();
        }
        if ($("#titleImage").val()===""||$("#describeImage").val()===""){
            var flag = confirm("您上传的图片有可能没有提交，是否继续");
            if (!flag){
                me.holdSubmit(false);
                return;
            }
        }
        $.ajax({
        	url: "#springUrl('/sys/serviceItem/editServiceItem')",
            data: $(form).serialize(),
            type: "POST",
            success: function(data){
            	var d = JSON.parse(data);
                if(d.success && d.data){
                	window.parent.location.reload();
                } else {
                	//失败，提交表单成功后，释放hold，如果不释放hold，就变成了只能提交一次的表单
                    me.holdSubmit(false);
                }
            }
        });
    }
});

</script>
</body>
</html>
